<table border="0" width="100%" cellpadding="1" cellspacing="1" bgcolor="$GetVar(HtmlTableFirstcolColour)">

<tr ALIGN='left' NAME='SNUM_REFINEMENT_PROGRAM' width='100%'>
<!-- #include tool-help-first-column gui\blocks\tool-help-first-column.htm;help_ext=Refinement-Program;1; -->
<!-- #include row_table_on gui\blocks\row_table_on.htm;1; -->
  <td width='30%'>
    <b>Refinement Program</b>
  </td>
  <td ALIGN='right' width='28%'>
<!-- #include program gui\snippets\snippet-program.htm;scope=snum;prg_type=refinement;1; -->
  </td>
  <td align='right' width='14%'>
    <b>Method</b>
  </td>
  <td ALIGN='right' width='28%'>
<!-- #include method gui\snippets\snippet-method.htm;scope=snum;prg_type=refinement;1; -->
  </td>

<!-- #include row_table_off gui\blocks\row_table_off.htm;1; -->

<tr NAME='SET_REFLECTIONS' width='100%'>
<!-- #include tool-help-first-column gui\blocks\tool-help-first-column.htm;help_ext=Set-Reflection-File;1; -->
<!-- #include row_table_on gui\blocks\row_table_on.htm;1; -->
  <td ALIGN='left' width='30%'>
    <b>%Reflection File%</b>
  </td>
  <td ALIGN='right' width='70%'>
<!-- #include tool-footer gui\snippets\snippet-reflection-file.htm;1; -->
</td>
<!-- #include row_table_off gui\blocks\row_table_off.htm;1; -->

<tr ALIGN='left' NAME='SNUM_REFINEMENT_MAX_CYCLES'>
<!-- #include tool-help-first-column gui\blocks\tool-help-first-column.htm;help_ext=Refinement-Max-Cycles;1; -->
<!-- #include row_table_on gui\blocks\row_table_on.htm;1; -->
  <td ALIGN='left' width='50%'>
    <b>Max. refinement cycles and peaks</b>
  </td>

  <td align='right' width='11%'>
  <b>Cycles</b>
  </td>

  <td ALIGN='right' width='14%'>
      <input
        type='spin'
        width="100%"
        height="GetVar('HtmlSpinHeight')"
        bgcolor="spy.GetParam('gui.html.input_bg_colour')"
        name='SET_SNUM_REFINEMENT_MAX_CYCLES'
        value="spy.GetParam('snum.refinement.max_cycles')"
        onchange="spy.SetMaxCycles(html.GetValue('~name~'))"
      >
  </td>

  <td align='right' width='11%'>
  <b>Peaks</b>
  </td>

  <td ALIGN='right' width='14%'>
      <input
        type="spin"
        bgcolor="spy.GetParam('gui.html.input_bg_colour')"
        name="SET_SNUM_REFINEMENT_MAX_PEAKS"
        width="100%"
        height="GetVar('HtmlSPinHeight')"
        max='1000'
        value="math.eval(abs(spy.GetParam(snum.refinement.max_peaks)))"
        onchange="spy.SetMaxPeaks(html.GetValue('~name~'))"
      >
  </td>


<!-- #include row_table_off gui\blocks\row_table_off.htm;1; -->


<tr ALIGN='left' NAME='SNUM_WEIGHTING_SCHEME'>
<!-- #include tool-help-first-column gui\blocks\tool-help-first-column.htm;help_ext=Weighting-Scheme;1; -->
<!-- #include row_table_on gui\blocks\row_table_on.htm;1; -->
$spy.weightGuiDisplay()

   <td width="6%">$+
     html.Snippet("gui/snippets/input-checkbox", "name=SET_SNUM_REFINEMENT_UPDATE_WEIGHT",
      "checked=spy.GetParam('snum.refinement.update_weight')",
      "bgcolor=GetVar('HtmlTableFirstcolColour')",
      "onclick=spy.SetParam('snum.refinement.update_weight', html.GetState('~name~'))")
    $-</td>

   <td width='32%'><b>Auto-update</b> when R1 &lt;</td>

   <td width="10%">$+
     html.Snippet("gui/snippets/input-text", "name=UPDATE_WEIGHT_MINR1",
      "width=100%",
      "value=spy.GetParam('snum.refinement.update_weight_maxR1')",
      "onchange=spy.SetParam('snum.refinement.update_weight_maxR1',html.GetValue(~name~))")
    $-</td>

    <td width="1%">%</td>
<!-- #include row_table_off gui\blocks\row_table_off.htm;1; -->

<tr ALIGN='left' NAME='EXTINCTION'>
<!-- #include tool-help-first-column gui\blocks\tool-help-first-column.htm;help_ext=Extinction-Correction;1; -->
<!-- #include row_table_on gui\blocks\row_table_on.htm;1; -->
  <td width="6%">
    <input type="checkbox" 
      fgcolor="GetVar('HtmlFontColour')"
      bgcolor="GetVar('HtmlTableFirstcolColour')"
      name="SNUM_REFINEMENT_EXTI"
      oncheck="AddIns EXTI"
      onuncheck="DelIns EXTI"
      checked="not(strcmp(xf.rm.Exti(),'n/a'))"
    >
  </td>
  <td width="28%"><b>Extinction correction</b></td>
  <td width="16%">
    $xf.rm.Exti()
  </td>
 

  <td width="6%">
    <input type="checkbox" 
      fgcolor="GetVar('HtmlFontColour')"
      bgcolor="GetVar('HtmlTableFirstcolColour')"
      name="SNUM_REFINEMENT_ACTA"
      oncheck="spy.SetParam(user.auto_insert_acta_stuff,True)"
      onuncheck="spy.SetParam(user.auto_insert_acta_stuff,False)"
      checked="spy.GetParam(user.auto_insert_acta_stuff)"
    >
  </td>
  <td width="44%"><b>CONF, MORE -1, Bond $H, ACTA</b></td>


<!-- #include row_table_off gui\blocks\row_table_off.htm;1; -->

<tr VALIGN="center" ALIGN="left" NAME="USE_SOLVENT_MASK">
<!-- #include tool-help-first-column gui\blocks\tool-help-first-column.htm;help_ext=refinement-masks;1; -->
<!-- #include row_table_on gui\blocks\row_table_on.htm;1; -->
  <td width='6%'>
      <input
        type="checkbox"
        fgcolor="GetVar('HtmlFontColour')"
        bgcolor="GetVar('HtmlTableFirstcolColour')"
        name="SNUM_REFINEMENT_USE_SOLVENT_MASK"
        checked="spy.GetParam('snum.refinement.use_solvent_mask')"
        onclick="spy.SetParam('snum.refinement.use_solvent_mask',html.GetState(~name~))"
      >
  </td>
  <td ALIGN='left' width='44%'>
    <b>
      Use solvent mask
    </b>
  </td>
  <td width='6%'>
      <input
        type="checkbox"
        fgcolor="GetVar('HtmlFontColour')"
        bgcolor="GetVar('HtmlTableFirstcolColour')"
        name="SNUM_REFINEMENT_RECOMPUTE_MASK_BEFORE_REFINEMENT"
        checked="spy.GetParam('snum.refinement.recompute_mask_before_refinement')"
        oncheck="
spy.SetParam('snum.refinement.use_solvent_mask','true')>>
spy.SetParam('snum.refinement.recompute_mask_before_refinement','true')>>
html.SetState('SNUM_REFINEMENT_USE_SOLVENT_MASK', 'true')"
        onuncheck="spy.SetParam('snum.refinement.recompute_mask_before_refinement','false')"
      >
  </td>
  <td ALIGN='left' width='44%'>
    <b>
      Recompute mask
    </b>
  </td>
<!-- #include row_table_off gui\blocks\row_table_off.htm;1; -->
</table>

<table border="0" style="border-collapse: collapse" width="100%" cellpadding="1" cellspacing="1" bgcolor="$GetVar(HtmlTableFirstcolColour)">
<!-- #includeif fs.Exists('refinement-settings-extra.htm') refinement-settings-extra refinement-settings-extra.htm;gui\blocks\tool-h3-off.htm;image=h3-refinement settings extra;colspan=4;onclick=;onclick=;2; -->
<!-- #includeif fs.Exists('refinement_image.htm') refinement_image refinement_image.htm;1; -->
</table>